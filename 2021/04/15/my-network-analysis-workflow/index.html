<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Hugo 0.82.0" />


<title>A Lazy Person&#39;s Network Analysis Workflow - Networking Archives Blog</title>
<meta property="og:title" content="A Lazy Person&#39;s Network Analysis Workflow - Networking Archives Blog">


  <link href='https://networkingarchives.github.io/blog/favicon.ico' rel='icon' type='image/x-icon'/>



  








<link href='//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css' rel='stylesheet' type='text/css' />



<link rel="stylesheet" href="/blog/css/fonts.css" media="all">
<link rel="stylesheet" href="/blog/css/main.css" media="all">



  </head>
  <body>
    <div class="wrapper">
      <header class="header">
        <nav class="nav">
  <a href="/blog/" class="nav-logo">
    <img src="/blog/images/logo.png"
         width="50"
         height="50"
         alt="Logo">
  </a>

  <ul class="nav-links">
    
    <li><a href="/blog/about/">About</a></li>
    
    <li><a href="https://github.com/networkingarchives">GitHub</a></li>
    
    <li><a href="https://twitter.com/networkarchives">Twitter</a></li>
    
  </ul>
</nav>

      </header>


<main class="content" role="main">

  <article class="article">
    
    <span class="article-duration">10 min read</span>
    

    <h1 class="article-title">A Lazy Person&#39;s Network Analysis Workflow</h1>

    
    <span class="article-date">2021-04-15</span>
    

    <div class="article-content">
      
<script src="https://networkingarchives.github.io/blog/2021/04/15/my-network-analysis-workflow/index_files/header-attrs/header-attrs.js"></script>


<p>The Networking Archives project is using tools from other disciplines to write histories of seventeenth-century intelligencing and correspondence. Key in the toolset for the project is network analysis. Network analysis is a suite of tools developed to understand and analyse networks, specifically, network graphs, a formal term for a mathematical graph of entities, known as nodes, connected by vertices, or edges.</p>
<p>There are tonnes of tools available for converting data into a network format. This blog post is an outline of my network analysis workflow using R. It’s meant for anyone who either uses or intends to use the <a href="https://www.rstudio.com/">programming language R</a> and the suite of tools called the <a href="https://www.tidyverse.org/">tidyverse</a> for data science and would like to know what is (in my opinion) the easiest and most portable method for analysing networks.</p>
<p>One of the easiest data formats to contruct a network is an edge list: a simple dataframe with a list of the connections between each pair of nodes, one per line. It makes particular sense with correspondence data, which is often stored as a table of letters wit a ‘from’ and a ‘to’—more or less a ready-made edge list. In a correspondence dataset you might also have multiple sets of each of the edges (multiple letters between the same pair of individuals). You can add this to the edge list as an attribute called weight, which is simply another column.</p>
<p>I use three R network libraries to do almost everything network-related, from analysis to visualisation: <code>igraph</code>, <code>tidygraph</code> and <code>ggraph</code>. My goal is to port everything to a format which is really easy to work with using existing data analysis tools. That format is known as ‘tidy data’, and it is a way of working with data which is easily transferable across a range of uses. It also means you need to learn very little new programming if you stay within this ‘ecosystem’.</p>
<div id="import-network-data-with-igraph" class="section level3">
<h3>Import Network Data with Igraph</h3>
<p>The whole workflow uses four packages. The first is <code>tidyverse</code>, a collection of various packages used for data wrangling and analytics.</p>
<pre class="r"><code>library(tidyverse)</code></pre>
<p>Next I need some network data. On the project this is generally a comma separated values file containing the information for one letter per row. We turn the raw letter data into an edge list in a standardised format, with the from/to information, a letter date, a place, and a unique identifier for the letter. Because the dataset is large and the same names are often used repeatedly, we use a unique ID number rather than people or place names when constructing the edge list. The nice thing about working within the tidyverse is that it’s easy to then match the IDs back to actual names afterwards.</p>
<p>These edge lists can be turned into a network object using <code>igraph</code> and the function <code>graph_from_data_frame</code>. This takes the first two columns in a dataset and turns them into the network graph, using any additional columns as attributes. It’s best to have a couple of separate datasets. First, an edge list, using unique, unambiguous numeric IDs for people and place names. Next, additional lookup tables, just with the unique ID, the person’s name, and additional information, if you have it (which can be used to filter the network afterwards).</p>
<p>If you have multiple letters between individuals, you can count these as a weight in the network, and use it in calculations afterwards. You can do this with <code>tidyverse</code> commands: <code>group_by()</code> and <code>tally()</code>, changing the name of the new column to ‘weight’.</p>
<pre class="r"><code>sample = read_csv(&#39;https://programminghistorian.org/assets/exploring-and-analyzing-network-data-with-python/quakers_edgelist.csv&#39;)</code></pre>
<pre><code>## 
## ── Column specification ────────────────────────────────────────────────────────
## cols(
##   Source = col_character(),
##   Target = col_character()
## )</code></pre>
<pre class="r"><code>sample %&gt;% 
  group_by(Source, Target) %&gt;%
  tally(name = &#39;weight&#39;)</code></pre>
<pre><code>## # A tibble: 174 x 3
## # Groups:   Source [78]
##    Source                     Target            weight
##    &lt;chr&gt;                      &lt;chr&gt;              &lt;int&gt;
##  1 Alexander Parker           Sir Charles Wager      1
##  2 Alexander Skene of Newtyle Lilias Skene           1
##  3 Anthony Sharp              Samuel Clarridge       1
##  4 Anthony Sharp              Thomas Curtis          1
##  5 Anthony Sharp              William Edmundson      1
##  6 Benjamin Furly             Alexander Parker       1
##  7 Benjamin Furly             Robert Barclay         1
##  8 Benjamin Furly             William Caton          1
##  9 Benjamin Furly             William Penn           1
## 10 Dorcas Erbery              James Nayler           1
## # … with 164 more rows</code></pre>
<p>Next, turn the edge list into an igraph object using <code>graph_from_data_frame()</code>. If you want to specify that the network is undirected, use the argument <code>directed = FALSE</code>. It’s directed by default.</p>
</div>
<div id="turn-the-igraph-object-into-a-tbl_graph" class="section level3">
<h3>Turn the Igraph Object into a tbl_graph</h3>
<p>At this point, you could stop and use igraph to do all sorts of analysis on the network. However, at this point I transform the igraph object into a tblgraph, using <a href="https://www.data-imaginist.com/2017/introducing-tidygraph/">tidygraph</a>. A tbl_graph is a graph object which can be manipulated using tidyverse grammar. This means you can create a network and then use a whole range of standard data analysis functions on it as needed, without learning a whole new set of commands.</p>
<p>First, load the tidygraph library. Use <code>as_tbl_graph()</code> to turn the network into a tidygraph-style one:</p>
<pre class="r"><code>library(tidygraph)</code></pre>
<pre><code>## 
## Attaching package: &#39;tidygraph&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:stats&#39;:
## 
##     filter</code></pre>
<pre class="r"><code>sample_tbl_graph = sample %&gt;% as_tbl_graph()

sample_tbl_graph</code></pre>
<pre><code>## # A tbl_graph: 119 nodes and 174 edges
## #
## # A directed acyclic simple graph with 12 components
## #
## # Node Data: 119 x 1 (active)
##   name                      
##   &lt;chr&gt;                     
## 1 George Keith              
## 2 James Parnel              
## 3 Peter Collinson           
## 4 Joseph Wyeth              
## 5 Alexander Skene of Newtyle
## 6 Dorcas Erbery             
## # … with 113 more rows
## #
## # Edge Data: 174 x 2
##    from    to
##   &lt;int&gt; &lt;int&gt;
## 1     1    69
## 2     1    43
## 3     1    79
## # … with 171 more rows</code></pre>
<p>The tbl_graph is an object with two tables, one for the edges and one for the nodes. You can access each of the tables using the function activate(nodes) or activate(edges). The active table has (active) after it.</p>
<pre class="r"><code>sample_tbl_graph = sample_tbl_graph %&gt;% activate(edges)

sample_tbl_graph</code></pre>
<pre><code>## # A tbl_graph: 119 nodes and 174 edges
## #
## # A directed acyclic simple graph with 12 components
## #
## # Edge Data: 174 x 2 (active)
##    from    to
##   &lt;int&gt; &lt;int&gt;
## 1     1    69
## 2     1    43
## 3     1    79
## 4     1     8
## 5     1    67
## 6     1    18
## # … with 168 more rows
## #
## # Node Data: 119 x 1
##   name           
##   &lt;chr&gt;          
## 1 George Keith   
## 2 James Parnel   
## 3 Peter Collinson
## # … with 116 more rows</code></pre>
<p>Tidygraph allows you to perform calculations on the tbl_graph using <code>mutate</code>, using standard igraph algorithms. So for example to calculate the degree of every node:</p>
<pre class="r"><code>sample_tbl_graph %&gt;% 
  activate(nodes) %&gt;% 
  mutate(degree = centrality_degree(mode = &#39;total&#39;))</code></pre>
<pre><code>## # A tbl_graph: 119 nodes and 174 edges
## #
## # A directed acyclic simple graph with 12 components
## #
## # Node Data: 119 x 2 (active)
##   name                       degree
##   &lt;chr&gt;                       &lt;dbl&gt;
## 1 George Keith                    8
## 2 James Parnel                    2
## 3 Peter Collinson                 2
## 4 Joseph Wyeth                    1
## 5 Alexander Skene of Newtyle      1
## 6 Dorcas Erbery                   1
## # … with 113 more rows
## #
## # Edge Data: 174 x 2
##    from    to
##   &lt;int&gt; &lt;int&gt;
## 1     1    69
## 2     1    43
## 3     1    79
## # … with 171 more rows</code></pre>
<p>If you run standard functions meant to be used on a dataframe, they will happen to the active table. So if you wanted to filter just edges from ID 1, for example, you could use the <code>filter</code> verb from dplyr:</p>
<pre class="r"><code>sample_tbl_graph %&gt;% filter(from ==1)</code></pre>
<pre><code>## # A tbl_graph: 119 nodes and 8 edges
## #
## # A rooted forest with 111 trees
## #
## # Edge Data: 8 x 2 (active)
##    from    to
##   &lt;int&gt; &lt;int&gt;
## 1     1    69
## 2     1    43
## 3     1    79
## 4     1     8
## 5     1    67
## 6     1    18
## # … with 2 more rows
## #
## # Node Data: 119 x 1
##   name           
##   &lt;chr&gt;          
## 1 George Keith   
## 2 James Parnel   
## 3 Peter Collinson
## # … with 116 more rows</code></pre>
<p>Maybe you only want to keep nodes with the name John? Activate the nodes again with <code>activate(nodes)</code>, then use <code>filter</code> and <code>str_detect</code> to filter based on a regular expressions pattern. You’ll see that it has filtered out unused edges now, too:</p>
<pre class="r"><code>sample_tbl_graph %&gt;% activate(nodes) %&gt;%  filter(str_detect(name, &quot;(?i)john&quot;))</code></pre>
<pre><code>## # A tbl_graph: 18 nodes and 5 edges
## #
## # A rooted forest with 13 trees
## #
## # Node Data: 18 x 1 (active)
##   name          
##   &lt;chr&gt;         
## 1 John Audland  
## 2 John Bellers  
## 3 John Stubbs   
## 4 John Camm     
## 5 John Wilkinson
## 6 John Swinton  
## # … with 12 more rows
## #
## # Edge Data: 5 x 2
##    from    to
##   &lt;int&gt; &lt;int&gt;
## 1     1     4
## 2     3    10
## 3     5    13
## # … with 2 more rows</code></pre>
<p>Slightly more useful might be to filter based on some calculation you’ve made previously. The data format allows you to use dplyr pipes (%&gt;%) to perform one calculation on the data, then pass that new dataframe along to the next function. It works really well with tidygraph. Here we calculate the degree scores first, then filter to include only nodes with a degree score over two:</p>
<pre class="r"><code>sample_tbl_graph %&gt;% 
  activate(nodes) %&gt;% 
  mutate(degree = centrality_degree(mode = &#39;total&#39;)) %&gt;% 
  filter(degree &gt;2)</code></pre>
<pre><code>## # A tbl_graph: 35 nodes and 81 edges
## #
## # A directed acyclic simple graph with 1 component
## #
## # Node Data: 35 x 2 (active)
##   name             degree
##   &lt;chr&gt;             &lt;dbl&gt;
## 1 George Keith          8
## 2 William Dewsbury      3
## 3 John Audland          6
## 4 Francis Howgill       7
## 5 William Bradford      3
## 6 Martha Simmonds       3
## # … with 29 more rows
## #
## # Edge Data: 81 x 2
##    from    to
##   &lt;int&gt; &lt;int&gt;
## 1     1    25
## 2     1    15
## 3     1    24
## # … with 78 more rows</code></pre>
</div>
<div id="visualisation-with-ggraph" class="section level3">
<h3>Visualisation with ggraph</h3>
<p>The last step in the workflow is visualising the network. You can use igraph and standard R plotting libraries for this, but I use a package called <a href="https://github.com/thomasp85/ggraph">ggraph</a>, which uses the same language as ggplot (a very well-known visualisation library for R) and adds some special functions to visualise networks. To create a network diagram, first use the function <code>ggraph</code> on your tbl_graph, then add the special <a href="https://ggplot2.tidyverse.org/reference/">ggraph geoms</a> <code>geom_node_point()</code> and <code>geom_edge_link()</code></p>
<pre class="r"><code>library(ggraph)

sample_tbl_graph %&gt;% ggraph(&#39;nicely&#39;) + geom_node_point() + geom_edge_link()</code></pre>
<p><img src="https://networkingarchives.github.io/blog/2021/04/15/my-network-analysis-workflow/index_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>You can use the dplyr pipes to perform calculations, filter the data and then visualise it, all in one go:</p>
<pre class="r"><code>sample_tbl_graph %&gt;% 
  activate(nodes)%&gt;% 
  mutate(degree = centrality_degree(mode = &#39;total&#39;)) %&gt;% 
  filter(degree &gt;2) %&gt;% ggraph(&#39;nicely&#39;) + geom_node_point() + geom_edge_link()</code></pre>
<p><img src="https://networkingarchives.github.io/blog/2021/04/15/my-network-analysis-workflow/index_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p><code>geom_node_point()</code> and <code>geom_edge_link</code> take aesthetics, just like regular ggplot geoms:</p>
<pre class="r"><code>sample_tbl_graph %&gt;% 
  activate(nodes)%&gt;% 
  mutate(degree = centrality_degree(mode = &#39;total&#39;))  %&gt;% 
  ggraph(&#39;nicely&#39;) + 
  geom_node_point(aes(size = degree)) + 
  geom_edge_link()</code></pre>
<p><img src="https://networkingarchives.github.io/blog/2021/04/15/my-network-analysis-workflow/index_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>Add <code>geom_node_text()</code> to add text labels to your network.</p>
<pre class="r"><code>sample_tbl_graph %&gt;% 
  activate(nodes)%&gt;% 
  mutate(degree = centrality_degree(mode = &#39;total&#39;))  %&gt;% 
  ggraph(&#39;nicely&#39;) + 
  geom_node_point(aes(size = degree)) + 
  geom_node_text(aes(label = name, size = degree), repel = TRUE) + 
  geom_edge_link(alpha = .2)</code></pre>
<p><img src="https://networkingarchives.github.io/blog/2021/04/15/my-network-analysis-workflow/index_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
</div>
<div id="networks---the-lazy-way" class="section level3">
<h3>Networks - the Lazy Way!</h3>
<p>Learning network analysis can be a big investment in time and effort, and, while the techniques do apply to lots of other areas of data science, it’s not the most transferable coding skill. I called the blog post the lazy person’s network analysis workflow because if you’ve already learned (or intend to learn) the much more general data science and visualisation skills of the <code>tidyverse</code> and <code>ggplot</code>, you’ve already done about 90% of the work. At the same time, any new things you do pick up when using this workflow on network analysis will feed back into your more general coding/data science knowledge.</p>
</div>

    </div>
  </article>

  


</main>

      <footer class="footer">
        <ul class="footer-links">
          <li>
            <a href="/blog/index.xml" type="application/rss+xml" target="_blank">RSS feed</a>
          </li>
          <li>
            <a href="https://gohugo.io/" class="footer-links-kudos">Made with <img src="/blog/images/hugo-logo.png" alt="Img link to Hugo website" width="22" height="22"></a>
          </li>
        </ul>
      </footer>

    </div>
    



<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>



<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/r.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>
<script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>



    

    
  </body>
</html>

